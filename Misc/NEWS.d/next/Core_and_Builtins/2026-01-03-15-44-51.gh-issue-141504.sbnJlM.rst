Factor out tracing and optimization heuristics into a single object.
Patch by Donghee Na.
