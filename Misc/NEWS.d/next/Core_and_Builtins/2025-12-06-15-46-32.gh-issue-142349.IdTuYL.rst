Implement :pep:`810`. Patch by Pablo Galindo and Dino Viehland.
