Make the macos detection of architecture in cflags more robust
